!function(){define("app.config",["jquery"],function(a){"use strict";return{submitBtn:a("#submitBtn"),textInput:a("#textInput"),numWordsInput:a("#numWordsInput"),poem:a("#poem"),iphodCorpus:{}}}),require.config({shim:{bootstrap:{deps:["jquery"]}},baseUrl:"/markomposition/public/resources/scripts",paths:{jquery:"/markomposition/public/vendor/jquery.min",bootstrap:"//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min"}});var a=function(a){"use strict";String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})});$.ajax({url:"/markomposition/public/resources/IPhOD2_Words_Adapted.json",success:function(b){a.iphodCorpus=b}}),$("#formTab a").click(function(a){a.preventDefault(),$(this).tab("show")})},b=function(a,b){$("#feedbackText").show(),$.ajax({url:"/markomposition/public/resources/texts/"+b,success:function(b){a.textInput.val(b),$("#feedbackText").hide()}})};require(["jquery","app.config","generate","bootstrap"],function(c,d,e){"use strict";a(d),d.submitBtn.off("click"),d.submitBtn.click(e),c("#dickinson").click(function(){b(d,"dickinson.txt")}),c("#dante").click(function(){b(d,"divine_comedy.txt")}),c("#grimm").click(function(){b(d,"grimm.txt")})}),define("generate",["app.config","util"],function(a,b){"use strict";var c={},d=!1,e=50,f="There's not enough words for Markomposition to make poetry!",g="You need at least 2-4 words, depending on the fusion level, but the more words the better!",h="Whoops! Markomposition couldn't generate a poem using the given text and poem parameters. ",i="You might try adding more text as this gives the generator more choices to work with. Also, be sure that your text has a variety of words with different word lengths and ending sounds if you are using a poetic form that is defined by rhyme scheme or syllables!";return c.generate=function(){$("#feedbackPoem").show();var d,e,j={},k=a.textInput.val();if(k.replace("\n","<br>"),k.replace("	","&#160;&#160;&#160;&#160;"),j.words=k.split(/\s+/),j.chainLevel=parseInt($('input[name="chainInput"]:checked').val()),j.words.length<=j.chainLevel)return b.displayError(f,g),void $("#feedbackPoem").hide();if($("#freeVerseTab").hasClass("active"))c.freeVerse(j);else if($("#haikuTab").hasClass("active")){d="";var l=parseInt($("#numHaikuInput").val());for(e=0;l>e;e++)j.meterScheme=[5,7,5],0===c.meter(j)&&(d+=j.poem+"<br>");""===d?b.displayError(h,i):a.poem.html(d)}$("#feedbackPoem").hide()},c.freeVerse=function(c){var e,f=[];for(c.numWords=parseInt(a.numWordsInput.val()),c.enjambmentLevel=$('input[name="enjambmentInput"]:checked').val(),b.setUpWhitespace(c),d&&(console.log("Words: ",c.words),console.log("Chain Length: ",c.chainLevel),console.log("numWords: ",c.numWords)),c.model={},e=0;e<c.words.length-c.chainLevel;e++){var g=b.getTuple(c,e);void 0===c.model[g]&&(c.model[g]={tuple:g,nextWords:[]}),c.model[g].nextWords.push(c.words[e+c.chainLevel])}d&&console.log("Model: ",c.model);for(var h in c.model)c.model.hasOwnProperty(h)&&void 0!==c.model[h].tuple&&f.push(c.model[h].tuple);for(d&&console.log("allTuples: ",f),c.currentTuple=b.randomChoice(f),c.poem=c.currentTuple[0],d&&console.log(c.currentTuple),e=1;e<c.currentTuple.length;e++)c.poem+=b.randomChoice(c.WHITESPACE)+c.currentTuple[e];for(d&&console.log("Poem (begin): ",c.poem),e=0;e<c.numWords-c.chainLevel&&void 0!==c.model[c.currentTuple];e++){var i=b.makeNextTuple(c);c.poem+=b.randomChoice(c.WHITESPACE)+i[c.chainLevel-1],c.currentTuple=i}d&&console.log("Poem: ",c.poem),a.poem.html(c.poem)},c.haiku=function(c){var f,g,j,k=[],l=5,m=7,n=0;for(c.MAX_SYLLABLES=7,g=parseInt($("#numHaikuInput").val()),a.poem.html(""),d&&(console.log("Words: ",c.words),console.log("Chain Length: ",c.chainLevel)),c.model={},j=0;j<c.words.length-c.chainLevel;j++){var o=b.getTuple(c,j);void 0===c.model[o]&&(c.model[o]={tuple:o,nextWords:[]});var p=c.words[j+c.chainLevel],q=b.getSyllableWord(p);q>=0&&c.model[o].nextWords.push(p)}d&&console.log("Model: ",c.model);for(var r in c.model)c.model.hasOwnProperty(r)&&void 0!==c.model[r].tuple&&k.push(c.model[r].tuple);for(d&&console.log("allTuples: ",k),f=0;e*g>f;f++)if(d&&console.debug("attempt: "+f),c.currentTuple=b.randomChoice(k),b.getSyllableTuple(c.currentTuple)>l)d&&console.debug("first tuple too long");else{for(c.poem=c.currentTuple[0],c.syllablesLeft=l-b.getSyllableTuple(c.currentTuple),d&&console.log(c.currentTuple),j=1;j<c.currentTuple.length;j++)c.poem+=" "+c.currentTuple[j];if(d&&console.log("Poem (begin): ",c.poem),-1!==b.completeLine(c))if(c.syllablesLeft=m,-1!==b.completeLine(c))if(c.syllablesLeft=l,-1!==b.completeLine(c)){if(c.poem+="<br>",a.poem.append(c.poem),n++,n===g)return}else d&&console.debug("no options on third line");else d&&console.debug("no options on second line");else d&&console.debug("no options on first line")}0===n&&b.displayError(h,i)},c.meter=function(a){var c,f,g,h;if(a.MAX_SYLLABLES=Math.max.apply(Math,a.meterScheme),d&&(console.log("Words: ",a.words),console.log("Chain Length: ",a.chainLevel)),void 0===a.model){for(a.model={},h=0;h<a.words.length-a.chainLevel;h++){var i=b.getTuple(a,h);void 0===a.model[i]&&(a.model[i]={tuple:i,nextWords:[]});var j=a.words[h+a.chainLevel],k=b.getSyllableWord(j);k>=0&&a.model[i].nextWords.push(j)}d&&console.log("Model: ",a.model),a.allTuples=[];for(var l in a.model)a.model.hasOwnProperty(l)&&void 0!==a.model[l].tuple&&a.allTuples.push(a.model[l].tuple)}d&&console.log("allTuples: ",a.allTuples);a:for(c=0;e>c;c++){if(d&&console.debug("attempt: "+c),a.currentTuple=b.randomChoice(a.allTuples),g=b.getSyllableTuple(a.currentTuple),!(g>a.meterScheme[0])){for(a.syllablesLeft=a.meterScheme[0]-g,a.poem=a.currentTuple.join(" "),f=0;f<a.meterScheme.length;f++){if(-1===b.completeLine(a)){d&&console.debug("no options on line "+f);continue a}f<a.meterScheme.length-1&&(a.syllablesLeft=a.meterScheme[f+1])}return 0}d&&console.debug("first tuple too long")}return-1},c.generate}),define("util",["jquery","app.config"],function(a,b){var c={};return c.displayError=function(a,c){b.poem.html('<h3 class="text-danger">'+a+"</h3><p>"+c+"</p>")},c.randomChoice=function(a){return a[Math.floor(Math.random()*a.length)]},c.stripWord=function(a){return a.trim().replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s]/g,"").toLowerCase()},c.getSyllableWord=function(a){var d=b.iphodCorpus[c.stripWord(a)];return void 0!==d?d.numSyllables:""===c.stripWord(a)?0:-1},c.getSyllableTuple=function(a){var d,e,f=0;for(e=0;e<a.length;e++)if(d=b.iphodCorpus[c.stripWord(a[e])],void 0!==d)f+=d.numSyllables;else if(""!==c.stripWord(a[e]))return-1;return f},c.addWhitespace=function(a,b,c){var d;for(d=0;c>d;d++)a.WHITESPACE.push(b)},c.setUpWhitespace=function(a){switch(a.WHITESPACE=[],a.enjambmentLevel){case"most":c.addWhitespace(a,"&#160;",50),c.addWhitespace(a,"&#160;&#160;",25),c.addWhitespace(a,"&#160;&#160;&#160;&#160;&#160;",25),c.addWhitespace(a,"<br>",20),c.addWhitespace(a,"<br><br>",20),c.addWhitespace(a,"<br>&#160;",20),c.addWhitespace(a,"<br>&#160;&#160;",20),c.addWhitespace(a,"<br>&#160;&#160;&#160;&#160;",20);break;case"medium":c.addWhitespace(a,"&#160;",100),c.addWhitespace(a,"&#160;&#160;",25),c.addWhitespace(a,"<br>",25),c.addWhitespace(a,"<br>&#160;",25),c.addWhitespace(a,"<br>&#160;&#160;",25);break;default:c.addWhitespace(a,"&#160;",175),c.addWhitespace(a,"<br>",25)}},c.getTuple=function(a,b){var c,d=[];for(c=0;c<a.chainLevel;c++)d.push(a.words[b+c]);return d},c.makeNextTuple=function(a){return a.currentTuple.slice(1,a.chainLevel).concat(c.randomChoice(a.model[a.currentTuple].nextWords))},c.makeAllNextTuples=function(a){var b,d,e=[];if(void 0===a.model[a.currentTuple])return e;b=a.model[a.currentTuple].nextWords;for(d in b){var f=b[d],g=c.getSyllableWord(f);g>a.syllablesLeft||-1===g||e.push(a.currentTuple.slice(1,a.chainLevel).concat(f))}return e},c.completeLine=function(a){for(var b,d,e;a.syllablesLeft>0;){if(e=c.makeAllNextTuples(a),0===e.length)return-1;b=c.randomChoice(e),d=b[a.chainLevel-1],a.poem+=" "+d,a.syllablesLeft-=c.getSyllableWord(d),a.currentTuple=b}return a.poem+="<br>",0},c})}();