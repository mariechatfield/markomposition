!function(){define("app.config",["jquery"],function(a){"use strict";return{submitBtn:a("#submitBtn"),textInput:a("#textInput"),numWordsInput:a("#numWordsInput"),poem:a("#poem"),iphodCorpus:{}}}),require.config({shim:{bootstrap:{deps:["jquery"]}},baseUrl:"/markomposition/public/resources/scripts",paths:{jquery:"/markomposition/public/vendor/jquery.min",bootstrap:"//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min"}});var a=function(a){"use strict";String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})});$.ajax({url:"/markomposition/public/resources/IPhOD2_Words_Adapted.json",success:function(b){a.iphodCorpus=b}}),$("#formTab a").click(function(a){a.preventDefault(),$(this).tab("show")})},b=function(a,b){$("#feedbackText").show(),$.ajax({url:"/markomposition/public/resources/texts/"+b,success:function(b){a.textInput.val(b),$("#feedbackText").hide()}})};require(["jquery","app.config","generate","bootstrap"],function(c,d,e){"use strict";a(d),d.submitBtn.off("click"),d.submitBtn.click(e),c("#dickinson").click(function(){b(d,"dickinson.txt")}),c("#dante").click(function(){b(d,"divine_comedy.txt")}),c("#grimm").click(function(){b(d,"grimm.txt")})}),define("generate",["app.config","util"],function(a,b){"use strict";var c={};return c.generate=function(){$("#feedbackPoem").show();var b={},d=a.textInput.val();d.replace("\n","<br>"),d.replace("	","&#160;&#160;&#160;&#160;"),b.words=d.split(/\s+/),b.model={},b.chainLevel=parseInt($('input[name="chainInput"]:checked').val()),$("#freeVerseTab").hasClass("active")?c.freeVerse(b):$("#haikuTab").hasClass("active")&&c.haiku(b),$("#feedbackPoem").hide()},c.freeVerse=function(c){var d,e=[];for(c.numWords=parseInt(a.numWordsInput.val()),c.enjambmentLevel=$('input[name="enjambmentInput"]:checked').val(),b.setUpWhitespace(c),d=0;d<c.words.length-c.chainLevel;d++){var f=b.getTuple(c,d);void 0===c.model[f]&&(c.model[f]={tuple:f,nextWords:[]}),c.model[f].nextWords.push(c.words[d+c.chainLevel])}for(var g in c.model)c.model.hasOwnProperty(g)&&void 0!==c.model[g].tuple&&e.push(c.model[g].tuple);for(c.currentTuple=b.randomChoice(e),c.poem=c.currentTuple[0],d=1;d<c.currentTuple.length;d++)c.poem+=b.randomChoice(c.WHITESPACE)+c.currentTuple[d];for(d=0;d<c.numWords-c.chainLevel&&void 0!==c.model[c.currentTuple];d++){var h=b.makeNextTuple(c);c.poem+=b.randomChoice(c.WHITESPACE)+h[c.chainLevel-1],c.currentTuple=h}a.poem.html(c.poem)},c.haiku=function(c){var d,e,f,g=[],h=5,i=7,j=50,k=0;for(c.MAX_SYLLABLES=7,e=parseInt($("#numHaikuInput").val()),a.poem.html(""),f=0;f<c.words.length-c.chainLevel;f++){var l=b.getTuple(c,f);void 0===c.model[l]&&(c.model[l]={tuple:l,nextWords:[]});var m=c.words[f+c.chainLevel],n=b.getSyllableWord(m);n>=0&&c.model[l].nextWords.push(m)}for(var o in c.model)c.model.hasOwnProperty(o)&&void 0!==c.model[o].tuple&&g.push(c.model[o].tuple);for(d=0;j*e>d;d++)if(c.currentTuple=b.randomChoice(g),!(b.getSyllableTuple(c.currentTuple)>h)){for(c.poem=c.currentTuple[0],c.syllablesLeft=h-b.getSyllableTuple(c.currentTuple),f=1;f<c.currentTuple.length;f++)c.poem+=" "+c.currentTuple[f];if(-1!==b.completeLine(c)&&(c.syllablesLeft=i,-1!==b.completeLine(c)&&(c.syllablesLeft=h,-1!==b.completeLine(c)&&(c.poem+="<br>",a.poem.append(c.poem),k++,k===e))))return}0===k&&b.displayError("Uh-oh! Couldn't create a poem. Try again!")},c.generate}),define("util",["jquery","app.config"],function(a,b){var c={};return c.displayError=function(a){b.poem.html('<h3 class="text-danger">'+a+"</h3>")},c.randomChoice=function(a){return a[Math.floor(Math.random()*a.length)]},c.stripWord=function(a){return a.trim().replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s]/g,"").toLowerCase()},c.getSyllableWord=function(a){var d=b.iphodCorpus[c.stripWord(a)];return void 0!==d?d.numSyllables:""===c.stripWord(a)?0:-1},c.getSyllableTuple=function(a){var d,e,f=0;for(e=0;e<a.length;e++)if(d=b.iphodCorpus[c.stripWord(a[e])],void 0!==d)f+=d.numSyllables;else if(""!==c.stripWord(a[e]))return-1;return f},c.addWhitespace=function(a,b,c){var d;for(d=0;c>d;d++)a.WHITESPACE.push(b)},c.setUpWhitespace=function(a){switch(a.WHITESPACE=[],a.enjambmentLevel){case"most":c.addWhitespace(a,"&#160;",50),c.addWhitespace(a,"&#160;&#160;",25),c.addWhitespace(a,"&#160;&#160;&#160;&#160;&#160;",25),c.addWhitespace(a,"<br>",20),c.addWhitespace(a,"<br><br>",20),c.addWhitespace(a,"<br>&#160;",20),c.addWhitespace(a,"<br>&#160;&#160;",20),c.addWhitespace(a,"<br>&#160;&#160;&#160;&#160;",20);break;case"medium":c.addWhitespace(a,"&#160;",100),c.addWhitespace(a,"&#160;&#160;",25),c.addWhitespace(a,"<br>",25),c.addWhitespace(a,"<br>&#160;",25),c.addWhitespace(a,"<br>&#160;&#160;",25);break;default:c.addWhitespace(a,"&#160;",175),c.addWhitespace(a,"<br>",25)}},c.getTuple=function(a,b){var c,d=[];for(c=0;c<a.chainLevel;c++)d.push(a.words[b+c]);return d},c.makeNextTuple=function(a){return a.currentTuple.slice(1,a.chainLevel).concat(c.randomChoice(a.model[a.currentTuple].nextWords))},c.makeAllNextTuples=function(a){var b,d,e=[];if(void 0===a.model[a.currentTuple])return e;b=a.model[a.currentTuple].nextWords;for(d in b){var f=b[d],g=c.getSyllableWord(f);g>a.maxSyllables||-1===g||e.push(a.currentTuple.slice(1,a.chainLevel).concat(f))}return e},c.completeLine=function(a){for(var b,d,e;a.syllablesLeft>0;){if(e=c.makeAllNextTuples(a),0===e.length)return-1;b=c.randomChoice(e),d=b[a.chainLevel-1],a.poem+=" "+d,a.syllablesLeft-=c.getSyllableWord(d),a.currentTuple=b}return a.poem+="<br>",0},c})}();