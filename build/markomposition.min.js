!function(){define("app.config",["jquery"],function(a){"use strict";return{submitBtn:a("#submitBtn"),textInput:a("#textInput"),numWordsInput:a("#numWordsInput"),poem:a("#poem"),iphodCorpus:{}}}),require.config({shim:{bootstrap:{deps:["jquery"]}},baseUrl:"/markomposition/public/resources/scripts",paths:{jquery:"/markomposition/public/vendor/jquery.min",bootstrap:"//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min"}});var a=function(a){"use strict";String.prototype.format||(String.prototype.format=function(){var a=arguments;return this.replace(/{(\d+)}/g,function(b,c){return"undefined"!=typeof a[c]?a[c]:b})});$.ajax({url:"/markomposition/public/resources/IPhOD2_Words_Adapted.json",success:function(b){a.iphodCorpus=b}}),$("#formTab a").click(function(a){a.preventDefault(),$(this).tab("show")})},b=function(a,b){$("#feedbackText").show(),$.ajax({url:"/markomposition/public/resources/texts/"+b,success:function(b){a.textInput.val(b),$("#feedbackText").hide()}})};require(["jquery","app.config","generate","bootstrap"],function(c,d,e){"use strict";a(d),d.submitBtn.off("click"),d.submitBtn.click(e),c("#dickinson").click(function(){b(d,"dickinson.txt")}),c("#dante").click(function(){b(d,"divine_comedy.txt")}),c("#grimm").click(function(){b(d,"grimm.txt")})}),define("generate",["app.config","util"],function(a,b){"use strict";var c,d,e,f,g,h,i,j={},k=function(a,b){var d;for(d=0;b>d;d++)c.push(a)},l=function(a){return a[Math.floor(Math.random()*a.length)]},m=function(a){var b,c=[];for(b=0;f>b;b++)c.push(d[a+b]);return c},n=function(a){switch(c=[],a){case"most":k("&#160;",50),k("&#160;&#160;",25),k("&#160;&#160;&#160;&#160;&#160;",25),k("<br>",20),k("<br><br>",20),k("<br>&#160;",20),k("<br>&#160;&#160;",20),k("<br>&#160;&#160;&#160;&#160;",20);break;case"medium":k("&#160;",100),k("&#160;&#160;",25),k("<br>",25),k("<br>&#160;",25),k("<br>&#160;&#160;",25);break;default:k("&#160;",175),k("<br>",25)}};j.generate=function(){$("#feedbackPoem").show(),j.haiku(),$("#feedbackPoem").hide()};var o=function(a){return a.slice(1,f).concat(l(e[a].nextWords))};j.freeVerse=function(){var b,i=a.textInput.val(),j=parseInt(a.numWordsInput.val()),k=$('input[name="enjambmentInput"]:checked').val(),p=[];for(i.replace("\n","<br>"),i.replace("	","&#160;&#160;&#160;&#160;"),d=i.split(/\s+/),e={},f=parseInt($('input[name="chainInput"]:checked').val()),n(k),b=0;b<d.length-f;b++){var q=m(b);void 0===e[q]&&(e[q]={tuple:q,nextWords:[]}),e[q].nextWords.push(d[b+f])}for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r].tuple&&p.push(e[r].tuple);for(g=l(p),h=g[0],b=1;b<g.length;b++)h+=l(c)+g[b];for(b=0;j-f>b&&void 0!==e[g];b++){var s=o(g);h+=l(c)+s[f-1],g=s}a.poem.html(h)};var p=function(a,c){var d,g,h=[];if(void 0===e[a])return h;d=e[a].nextWords;for(g in d){var i=d[g],j=b.getSyllableWord(i);j>c||-1===j||h.push(a.slice(1,f).concat(i))}return h},q=function(){for(var a,c,d;i>0;){if(d=p(g,i),0===d.length)return-1;a=l(d),c=a[f-1],h+=" "+c,i-=b.getSyllableWord(c),g=a}return 0};return j.haiku=function(){var c,j,k,n=a.textInput.val(),o=[],p=5,r=7,s=50,t=0,u='<h3 class="text-danger">Uh-oh... couldn\'t create a haiku. Try again!</h3>';for(a.poem.html(""),n.replace("\n","<br>"),n.replace("	","&#160;&#160;&#160;&#160;"),d=n.split(/\s+/),e={},f=parseInt($('input[name="chainInput"]:checked').val()),j=parseInt($("#numHaikuInput").val()),k=0;k<d.length-f;k++){var v=m(k);void 0===e[v]&&(e[v]={tuple:v,nextWords:[]});var w=d[k+f],x=b.getSyllableWord(w);x>=0&&e[v].nextWords.push(w)}for(var y in e)e.hasOwnProperty(y)&&void 0!==e[y].tuple&&o.push(e[y].tuple);for(c=0;s*j>c;c++)if(g=l(o),!(b.getSyllableTuple(g)>p)){for(h=g[0],i=p-b.getSyllableTuple(g),k=1;k<g.length;k++)h+=" "+g[k];if(-1!==q(g)&&(h+="<br>",i=r,-1!==q(g)&&(h+="<br>",i=p,-1!==q(g)&&(h+="<br><br>",a.poem.append(h),t++,t===j))))return}0===t&&a.poem.html(u)},j.generate}),define("util",["jquery","app.config"],function(a,b){var c={};return c.stripWord=function(a){return a.trim().replace(/[\.,-\/#!$%\^&\*;:{}=\-_`~()\s]/g,"").toLowerCase()},c.getSyllableWord=function(a){var d=b.iphodCorpus[c.stripWord(a)];return void 0!==d?d.numSyllables:""===c.stripWord(a)?0:-1},c.getSyllableTuple=function(a){var d,e,f=0;for(e=0;e<a.length;e++)if(d=b.iphodCorpus[c.stripWord(a[e])],void 0!==d)f+=d.numSyllables;else if(""!==c.stripWord(a[e]))return-1;return f},c})}();